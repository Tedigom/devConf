# 1. Re:Invent 서비스 소개
## CodeGuru
소스코드 리뷰 및 높은 비용이나 오류를 유발하는 코드 수정 또는 개선을 자동으로 해주는 개발팀을 위한 인공지능 서비스.

--> 메모리나 CPU를 많이 먹는 코드를 발견 후, 최적화 시킬 수 있게함.



Amazon personalize(개인화 추천 서비스), Amazon Forecast(시계열 예측 서비스), Amazon Fraud Detector(온라인 결제사기 및 부정사용을 식별하는 관리형 AI 서비스), Contact Lens(고객 대화에 대한 음성인식, 자연어 처리)

—> 비즈니스에 직접 영향을 주는 AI 서비스


Serverless
- provisioned concurrency on AWS Lamba
- HTTP APIs for amazon api gateway



===================================================

# 2. 전세계 팬들이 모일 수 있는 플랫폼 만들기
beNX 

조금 다른 트래픽 패턴을 보임 = 평소에는 안정되어 있지만, 순간적으로 평상시의 약 100배 정도의 트래픽이 순간적으로 들어옴.

어떻게 효율적으로 운영할 수 있는가? - AutoScaling policy에 의존하면 한 템포 늦음

사전에 증설되어야 하는 순간을 감지할 수는 없을까?
-> Event Driven AutoScaling : 이벤트에 동작하는 오토스케일링
						    :  오토스케일링을 트리거링 하는 조건이 이벤트 

이벤트의 정의
1. Predefined Event : 미리 정의되어있는 이벤트 ( MD 판매 이벤트 )
2. Undefined Event : 미리 정의되어 있지 않는 이벤트 ( ex. 아티스트들의 글 작성 ) - 사전대응이 불가능함.

## Predefined Event
언제 발생할지 미리 알고 있기 때문에 사전 대응이 가능함. ==> 사전 증설하여 대응할 수 있음.
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.09.57.png)
<predefined architecture>

## Undefined Event 
언제 발생할 수 없기 때문에 사전 대응이 불가능함.
Undefined Event를 감지하는 것이 서버 안정화의 핵심.

아티스트가 글을 올릴 때 푸쉬가 올라옴.,

푸쉬를 undefined Event의 이벤트로 생각하는것이 시작
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.13.28.png)
<Undefined Event>

## 해결해야할 과제들
- Auto scaling에 소요되는 시간의 최소화 - 배포과정의 최적화
(기존)
전체 과정이 5분정도 소요됨. -> 너무 긴 시간
(개선)
전체 과정이 3분정도 소요됨 
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.19.39.png)



- 증설되는 동안 최대한 버티기 - 인스턴스 성능의 최적화
“잘 튜닝된 t3.medium, 열 c5.xlarge 안부럽다”
—> 성능 최적화의 핵심은 모든 리소스를 최대한 활용하는 것.

OS의 디폴트 설정으로 인해 애플리케이션 설정에 영향을 받지 않아야 함.
nginX, tomcat 등 default setting에 대해 유의해야함. + 충분한 숫자의 커넥션 풀 설정이 필요함
CPU 코어에 초점을 맞춰서 튜닝하는 것이 더욱 효과적

https://www.nginx.com/blog/tuning-nginx
nginX의 튜닝을 위한 도움 링크 ( Front, Back)


## 고려하고 있는 것들
더 빠른 서버 프로비저닝을 위해 고려하고 있는 사항들

* EKS on Fargate
* EC2 Hibernate


===================================================


# 3. 스푼라디오 일본에서 한국으로 이전하기
일본 리전에서 서울 리전으로 마이그레이션

## 생각했던 마이그레이션 전략
- 안전
- AWS Well-Architected Frameworks
- 자동화
- 모니터링

### 무엇을 이전할 것인가?
* 80개의 워크로드
	* 50여개 EC2
	* 150GB DB
	* 300TB S3
	* 10여개 Serverless   ——> 모두 미션크리티컬한 자원들

## 자동화 도구들
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.50.02.png)


# Rebuilding Infra
Multi Account AWS
각 서비스 용도별 Account 구성
- HUB ( IAM user )
- PRD/STG/DEV
- DATA & LOG
- MGT

# 신규 서비스 인프라 환경
고객들의 데이터 보호위해 완전히 격리된 형태로 아키텍처 구성

![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.54.17.png)


# 운영 시스템
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.55.13.png)

# 마이그레이션 준비
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.56.14.png)


# Database Migration
* Cross region replica
* Database migration Service
* Snapshot cross region copy & share , restore


## Cross Region Replica - 불가
서비스 중단 최소화
Aurora postgresql 지원하지 않음

## Database migration service(DMS) - 불가
서비스 중단 최소화
Aurora Postgresql 버전이 맞지 않아 사용하지 않음

## Snapshot cross region copy & share , restore
단순하지만 다른 방법에 비해 시간이 오래 걸림
서비스 중단 필요 (Operation 포함 60분)


# MongoDB Migration
* mongodump / mongorestore


# 계획과 현실
* 일주 전 부터 고객 사전 공지
* 계획대로 진행, 그러나 예상 외 이슈 발생(결제, LiveLB, DNS 등등)
	* 이슈 해결을 위해 6회 배포 진행

# 마이그레이션 이후
* 시스템 반응성 약 15% 향상
* 좀더 보안이 강화된 서비스 제공 기틀 마련


# 마이그레이션 로드맵
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-21%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.07.19.png)


===================================================

# 4. AWS 기반 서버리스 데이터 레이크 구축하기
## 데이터 분석의 딜레마
데이터로 하고 싶은 일 - 마케팅, 고객이탈 방지, 원인분석….
이미 겪고 있거나 예상되는 문제점들 - 데이터 한군데 저장 어려움, 레거시 vs 신규시스템, 다양한 데이터 포맷 정제 필요.. 등

## 데이터레이크의 정의
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.53.18.png)

## 데이터레이크 at AWS
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.53.44.png)


## DataOps
- 데이터 분석을 하는 시간을 줄이고 품질을 높이기 위해 프로세스 기반의 방법론
- DataOps menifesto

## 엔터프라이즈에서의 Data
- 경영 환경의 변화에 따른 Data 관리 어려움
- 분산된 환경으로 인한 data silo 컨셉


## 데이터 모으기
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.54.00.png)


## 데이터 레이크 컨셉 아키텍처
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.54.17.png)

## 설계 고려사항
* No-ops (Serverless)
* Gitops
* Automation

## 데이터 수집
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.55.21.png)

![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.55.32.png)

## 데이터 처리
Glue - 분성르 위해 손쉽게 데이터를 준비하고 로드할 수 있게 지원하는 완전관리형 ETL
이벤트 기반 Glue 파이프라인


![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.55.43.png)

## 데이터 분석
Satemaker Jupyter 노트북 : 모델 배치 / 테스트/ 검증
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.55.54.png)

## 데이터 포털 개발
![](20200121%20AWS%20Community%20day/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202020-01-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.56.46.png)

